---
- name: Provision VMs on Proxmox
  import_playbook: playbooks/provision.yml
  tags: ['provision']

# Configure PXE Server

# - name: Configure PXE Server
#   import_playbook: playbooks/pxe.yml
#   tags: ['pxe']

# Configure LANCache Server
- name: Configure LANCache Server
  import_playbook: playbooks/lancache.yml
  tags: ['lancache']

# Configure File Server
# - name: Configure File Server
#   import_playbook: playbooks/fileserver.yml
#   tags: ['fileserver']

# Verification
# - name: Verify Deployment
#   hosts: localhost
#   gather_facts: false
  
#   tasks:
#     - name: Final connectivity test
#       wait_for:
#         host: "{{ item }}"
#         port: 22
#         timeout: 30
#       loop:
#         - "{{ network.pxe_server }}"
#         - "{{ network.lancache_server }}"
#         - "{{ network.file_server }}"
    
#     - name: Display verification results
#       debug:
#         msg:
#           - "═══════════════════════════════════════════"
#           - "Deployment Complete!"
#           - "═══════════════════════════════════════════"
#           - ""
#           - "All VMs are up and accessible via SSH"
#           - ""
#           - "Next steps:"
#           - "  1. Check service status on each VM"
#           - "  2. Test PXE boot from a client"
#           - "  3. Configure user accounts on file server"
#           - ""